<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PF Strength Standards</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Smooth transitions */
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
        .animate-spin-slow { animation: spin 4s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        /* Hide scrollbar for tabs */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Celebration Animations */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop-in { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body class="bg-slate-100 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS (Inline SVGs) ---
        const IconWrapper = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        const Icons = {
            Activity: (props) => <IconWrapper {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></IconWrapper>,
            Dumbbell: (props) => <IconWrapper {...props}><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></IconWrapper>,
            ChevronDown: (props) => <IconWrapper {...props}><path d="m6 9 6 6 6-6"/></IconWrapper>,
            Target: (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></IconWrapper>,
            AlertCircle: (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconWrapper>,
            CheckCircle: (props) => <IconWrapper {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></IconWrapper>,
            TrendingUp: (props) => <IconWrapper {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconWrapper>,
            LayoutGrid: (props) => <IconWrapper {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></IconWrapper>,
            X: (props) => <IconWrapper {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconWrapper>,
            User: (props) => <IconWrapper {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconWrapper>,
            Settings: (props) => <IconWrapper {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconWrapper>,
            ArrowRight: (props) => <IconWrapper {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconWrapper>,
            Minus: (props) => <IconWrapper {...props}><path d="M5 12h14"/></IconWrapper>,
            Plus: (props) => <IconWrapper {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconWrapper>,
            Trophy: (props) => <IconWrapper {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconWrapper>,
            Moon: (props) => <IconWrapper {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></IconWrapper>,
            Sun: (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41-1.41"/><path d="m19.07 4.93-1.41 1.41"/></IconWrapper>,
            Lock: (props) => <IconWrapper {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconWrapper>,
            Save: (props) => <IconWrapper {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconWrapper>,
            Clock: (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconWrapper>,
            Info: (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="16" y2="12"/><line x1="12" x2="12.01" y1="8" y2="8"/></IconWrapper>,
            Palette: (props) => <IconWrapper {...props}><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></IconWrapper>,
            ArrowLeft: (props) => <IconWrapper {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconWrapper>,
            Star: (props) => <IconWrapper {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconWrapper>,
            Filter: (props) => <IconWrapper {...props}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></IconWrapper>
        };

        // --- CONSTANTS ---

        const AVATARS = ["ðŸ¦", "ðŸ¦", "ðŸ¦–", "ðŸ’ª", "ðŸƒ", "ðŸ§˜", "ðŸ¤–", "ðŸ‘½", "ðŸ¦Š", "âš¡"];

        const THEMES = {
            purple: { id: 'purple', name: 'Planet Purple', primary: 'bg-purple-600', primaryHover: 'hover:bg-purple-700', secondary: 'bg-purple-50', textMain: 'text-slate-900', textLight: 'text-slate-500', accentText: 'text-purple-700', border: 'border-purple-200', bgApp: 'bg-slate-50', card: 'bg-white' },
            ocean: { id: 'ocean', name: 'Ocean Blue', primary: 'bg-cyan-600', primaryHover: 'hover:bg-cyan-700', secondary: 'bg-cyan-50', textMain: 'text-slate-900', textLight: 'text-slate-500', accentText: 'text-cyan-700', border: 'border-cyan-200', bgApp: 'bg-slate-50', card: 'bg-white' },
            dark: { id: 'dark', name: 'Midnight', primary: 'bg-indigo-500', primaryHover: 'hover:bg-indigo-600', secondary: 'bg-slate-800', textMain: 'text-white', textLight: 'text-slate-400', accentText: 'text-indigo-400', border: 'border-slate-700', bgApp: 'bg-slate-900', card: 'bg-slate-800' }
        };

        const EXPERIENCE_LEVELS = [
            { label: 'Beginner', desc: 'Day 1 to 3 months. Learning movements.' },
            { label: 'Novice', desc: '3-9 months of consistent training.' },
            { label: 'Intermediate', desc: '1-2 years. Can control heavy loads.' },
            { label: 'Advanced', desc: '3+ years of dedicated strength training.' }
        ];

        const MACHINES_DATA = {
            "Chest Press": {
                "id": "chest_press",
                "target": "Pectorals (Chest), Triceps, Front Delts",
                "stackCap": 260,
                "ratio": 1,
                "tags": ["Upper", "Push"],
                "multipliers": { "Male": [0.30, 0.55, 0.85, 1.15], "Female": [0.20, 0.35, 0.55, 0.75] },
                "cues": ["Keep handles at mid-chest level (nipple line).", "Keep elbows slightly below shoulders (45-degree angle).", "Retract shoulder blades against the pad."],
                "adjustment": "Increase weight if you can easily do 15+ reps. Decrease if your lower back arches excessively.",
                "burnout": "Drop Set: Reduce weight by 30% and rep to failure."
            },
            "Pec Fly / Rear Delt": {
                "id": "pec_fly",
                "target": "Chest (Fly) or Rear Delts (Reverse)",
                "stackCap": 200,
                "ratio": 1,
                "tags": ["Upper", "Push"],
                "multipliers": { "Male": [0.20, 0.35, 0.55, 0.80], "Female": [0.12, 0.25, 0.40, 0.60] },
                "cues": ["Elbows slightly bent and locked.", "Motion comes from shoulder joint only.", "For Rear Delt: Face the pad."],
                "adjustment": "Increase only if you can control the negative without shaking.",
                "burnout": "Partials: 15 bottom-half reps."
            },
            "Lat Pulldown": {
                "id": "lat_pulldown",
                "target": "Latissimus Dorsi (Back), Biceps",
                "stackCap": 250,
                "ratio": 1,
                "tags": ["Upper", "Pull"],
                "multipliers": { "Male": [0.35, 0.60, 0.90, 1.20], "Female": [0.25, 0.40, 0.65, 0.90] },
                "cues": ["Grip slightly wider than shoulder-width.", "Pull bar down to upper chest.", "Lean back slightly (10â€“15Â°)."],
                "adjustment": "Increase if you aren't feeling it in your armpits/back.",
                "burnout": "Burnout: Hold the contracted position for 1 sec each rep."
            },
            "Seated Row": {
                "id": "seated_row",
                "target": "Middle Back (Rhomboids), Lats",
                "stackCap": 250,
                "ratio": 1,
                "tags": ["Upper", "Pull"],
                "multipliers": { "Male": [0.40, 0.65, 1.00, 1.35], "Female": [0.28, 0.45, 0.70, 0.95] },
                "cues": ["Keep chest firmly against the pad.", "Pull handles toward your waist/hips.", "Squeeze shoulder blades."],
                "adjustment": "Increase if you can touch the handles to your chest easily.",
                "burnout": "Drop Set: Reduce weight by 40% and do 15 fast-paced reps."
            },
            "Shoulder Press": {
                "id": "shoulder_press",
                "target": "Deltoids (Shoulders), Triceps",
                "stackCap": 200,
                "ratio": 1,
                "tags": ["Upper", "Push"],
                "multipliers": { "Male": [0.20, 0.40, 0.65, 0.95], "Female": [0.12, 0.25, 0.40, 0.60] },
                "cues": ["Adjust seat so handles are at ear level.", "Press straight up.", "Control the descent."],
                "adjustment": "Increase if the weight flies up. Decrease if you push with legs.",
                "burnout": "Burnout: 15 partial reps (bottom half of movement)."
            },
            "Leg Press (Sled)": {
                "id": "leg_press",
                "target": "Quads, Glutes, Hamstrings",
                "stackCap": 700,
                "ratio": 1,
                "tags": ["Lower", "Push"],
                "multipliers": { "Male": [1.00, 1.60, 2.30, 3.00], "Female": [0.70, 1.10, 1.60, 2.20] },
                "cues": ["Feet shoulder-width apart.", "Lower until knees are at 90 degrees.", "NEVER lock knees."],
                "adjustment": "Increase if 10 reps feels effortless.",
                "burnout": "Drop Set: Strip one plate (or ~20%) and rep to failure."
            },
            "Leg Extension": {
                "id": "leg_extension",
                "target": "Quadriceps (Front Thigh)",
                "stackCap": 200,
                "ratio": 1,
                "tags": ["Lower", "Push"],
                "multipliers": { "Male": [0.35, 0.60, 0.90, 1.20], "Female": [0.25, 0.45, 0.70, 0.95] },
                "cues": ["Align knee joint with the machine's pivot point.", "Pad just above ankles.", "Do NOT kick."],
                "adjustment": "Increase if you can hold the top squeeze easily.",
                "burnout": "Burnout: 20 rapid pulse reps."
            },
            "Seated Leg Curl": {
                "id": "leg_curl",
                "target": "Hamstrings (Back Thigh)",
                "stackCap": 200,
                "ratio": 1,
                "tags": ["Lower", "Pull"],
                "multipliers": { "Male": [0.35, 0.55, 0.80, 1.05], "Female": [0.25, 0.40, 0.60, 0.80] },
                "cues": ["Adjust thigh pad so it clamps legs down tight.", "Knees aligned with pivot.", "Control the way back up."],
                "adjustment": "Increase if hips stay planted easily.",
                "burnout": "Drop Set: Reduce weight 30% and do slow negatives."
            },
            "Back Extension": {
                "id": "back_extension",
                "target": "Lower Back (Erector Spinae)",
                "stackCap": 200,
                "ratio": 1,
                "tags": ["Lower", "Pull"],
                "multipliers": { "Male": [0.35, 0.55, 0.80, 1.05], "Female": [0.25, 0.40, 0.60, 0.80] },
                "cues": ["Axis of rotation aligned with hips.", "Push back with lower back.", "Avoid hyperextending."],
                "adjustment": "Increase carefully. Lower back is sensitive.",
                "burnout": "Hold the extended position for 30â€“45 seconds."
            },
            "Ab Crunch (Machine)": {
                "id": "ab_crunch",
                "target": "Abs (Rectus Abdominis)",
                "stackCap": 200,
                "ratio": 1,
                "tags": ["Core"],
                "multipliers": { "Male": [0.30, 0.50, 0.75, 1.00], "Female": [0.20, 0.35, 0.55, 0.75] },
                "cues": ["Focus on bringing ribcage to pelvis.", "Do NOT pull with arms.", "Exhale deeply."],
                "adjustment": "Increase if you aren't feeling the burn by rep 15.",
                "burnout": "Burnout: Hold the crunched position for 30 seconds."
            },
            "Cable Bicep Curl": {
                "id": "cable_curl",
                "target": "Biceps",
                "stackCap": 60,
                "ratio": 0.5,
                "tags": ["Upper", "Pull"],
                "multipliers": { "Male": [0.15, 0.25, 0.40, 0.55], "Female": [0.10, 0.20, 0.30, 0.40] },
                "cues": ["Keep elbows pinned to sides.", "Step back for tension.", "Note: 2:1 ratio (feels half heavy)."],
                "adjustment": "Increase if you don't feel a burn by rep 12.",
                "burnout": "21s: 7 bottom half, 7 top half, 7 full range."
            },
            "Cable Tricep Pushdown": {
                "id": "cable_tricep",
                "target": "Triceps",
                "stackCap": 70,
                "ratio": 0.5,
                "tags": ["Upper", "Push"],
                "multipliers": { "Male": [0.25, 0.40, 0.60, 0.85], "Female": [0.18, 0.30, 0.45, 0.65] },
                "cues": ["Keep elbows pinned.", "Push down and apart.", "Don't let elbows flare."],
                "adjustment": "Increase if you don't feel a burn by rep 12.",
                "burnout": "Drop set: Lower weight by 1 pin, go to failure."
            }
        };

        // --- SUB-COMPONENTS ---

        const calculateEstimated1RM = (weight, reps) => {
            if (!weight || !reps) return 0;
            if (reps === 1) return weight;
            return Math.round(weight * (1 + reps / 30));
        };

        const formatDate = (dateString) => {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
        };

        const StepperInput = ({ label, value, onChange, min = 0, step = 1, theme }) => {
            const [localVal, setLocalVal] = useState(value.toString());
            useEffect(() => { setLocalVal(value.toString()); }, [value]);
            const handleChange = (e) => {
                const val = e.target.value;
                setLocalVal(val);
                if (val !== "" && !isNaN(val)) onChange(Number(val));
            };
            const handleBlur = () => {
                if (localVal === "" || isNaN(localVal)) setLocalVal(value.toString());
                else onChange(Number(localVal));
            };
            return (
                <div className="flex-1">
                    <label className={`block text-xs font-bold ${theme.textLight} uppercase tracking-wider mb-2`}>{label}</label>
                    <div className={`flex items-center ${theme.card} border ${theme.border} rounded-xl p-1 transition-colors`}>
                        <button onClick={() => onChange(Math.max(min, value - step))} className={`w-10 h-10 flex items-center justify-center rounded-lg ${theme.textLight} hover:${theme.primary} hover:text-white transition-colors active:scale-95`}><Icons.Minus className="w-4 h-4" /></button>
                        <input type="number" value={localVal} onChange={handleChange} onBlur={handleBlur} className={`flex-1 text-center bg-transparent font-bold ${theme.textMain} text-lg focus:outline-none`} />
                        <button onClick={() => onChange(value + step)} className={`w-10 h-10 flex items-center justify-center rounded-lg ${theme.textLight} hover:${theme.primary} hover:text-white transition-colors active:scale-95`}><Icons.Plus className="w-4 h-4" /></button>
                    </div>
                </div>
            );
        };

        const AvatarSelect = ({ value, onChange, theme }) => (
            <div className="mb-4">
                <label className={`block text-xs font-bold ${theme.textLight} uppercase tracking-wider mb-2 text-center`}>Choose Avatar</label>
                <div className="flex justify-center flex-wrap gap-2">
                    {AVATARS.map((avatar) => (
                        <button key={avatar} onClick={() => onChange(avatar)} className={`w-10 h-10 flex items-center justify-center rounded-full text-lg transition-all border-2 ${value === avatar ? `${theme.border} ${theme.secondary} scale-110 shadow-sm` : `border-transparent hover:bg-slate-100`}`}>{avatar}</button>
                    ))}
                </div>
            </div>
        );

        const ThemeSelect = ({ value, onChange, theme }) => (
            <div className="mb-4">
                <label className={`block text-xs font-bold ${theme.textLight} uppercase tracking-wider mb-2 text-center`}>Theme</label>
                <div className="flex justify-center gap-3">
                    {Object.values(THEMES).map((t) => (
                        <button key={t.id} onClick={() => onChange(t.id)} className={`px-4 py-2 rounded-lg text-xs font-bold transition-all border-2 flex items-center gap-2 ${value === t.id ? `${theme.primary} text-white border-transparent` : `${theme.card} ${theme.textLight} border-transparent shadow-sm hover:border-slate-300`}`}>
                            {t.id === 'dark' ? <Icons.Moon className="w-3 h-3"/> : t.id === 'ocean' ? <Icons.Activity className="w-3 h-3"/> : <Icons.Sun className="w-3 h-3"/>}
                            {t.name}
                        </button>
                    ))}
                </div>
            </div>
        );

        const CelebrationModal = ({ data, onClose, theme }) => (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-in fade-in duration-300">
                <div className={`max-w-xs w-full ${theme.card} rounded-3xl p-6 text-center shadow-2xl animate-pop-in relative overflow-hidden`}>
                    <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-yellow-300 via-orange-400 to-yellow-300"></div>
                    <div className="mb-4 flex justify-center">
                        <div className={`w-20 h-20 rounded-full ${theme.secondary} flex items-center justify-center animate-float`}>
                            <Icons.Trophy className={`w-10 h-10 text-yellow-500`} />
                        </div>
                    </div>
                    <h2 className={`text-2xl font-extrabold ${theme.textMain} mb-1`}>Level Up!</h2>
                    <p className={`text-sm ${theme.textLight} mb-6`}>
                        You hit <strong className={theme.accentText}>{data.level}</strong> on {data.machine}!
                    </p>
                    <button onClick={onClose} className={`w-full py-3 rounded-xl font-bold text-white shadow-lg ${theme.primary} transition-transform active:scale-95`}>
                        Keep Crushing It
                    </button>
                </div>
            </div>
        );

        // --- MAIN APP ---

        const StrengthStandardsApp = () => {
            const loadState = (key, fallback) => {
                try {
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : fallback;
                } catch (e) { return fallback; }
            };

            const [view, setView] = useState(() => localStorage.getItem('pf_user_profile') ? 'dashboard' : 'onboarding'); 
            const [userProfile, setUserProfile] = useState(() => loadState('pf_user_profile', {
                username: 'Guest', weight: 180, age: 30, gender: 'Male', experience: 'Beginner', avatar: 'ðŸ¦', themeId: 'purple'
            }));
            const [userLifts, setUserLifts] = useState(() => loadState('pf_user_lifts', {})); 
            const [selectedMachine, setSelectedMachine] = useState(null);
            const [sessionLog, setSessionLog] = useState({ weight: '', reps: '' });
            const [isSaved, setIsSaved] = useState(false);
            const [viewMode, setViewMode] = useState('Working Set');
            const [activeTab, setActiveTab] = useState('workout'); 
            const [activeFilter, setActiveFilter] = useState('All');
            const [celebration, setCelebration] = useState(null);

            const currentTheme = THEMES[userProfile.themeId] || THEMES.purple;

            useEffect(() => { try { localStorage.setItem('pf_user_profile', JSON.stringify(userProfile)); } catch(e){} }, [userProfile]);
            useEffect(() => { try { localStorage.setItem('pf_user_lifts', JSON.stringify(userLifts)); } catch(e){} }, [userLifts]);

            useEffect(() => {
                if (selectedMachine) {
                    const history = userLifts[selectedMachine];
                    setSessionLog(history ? { weight: history.weight, reps: history.reps } : { weight: '', reps: '' });
                    setIsSaved(false);
                    setActiveTab('workout');
                }
            }, [selectedMachine]);

            const determineLevel = (machine, weight, reps) => {
                const est1RM = calculateEstimated1RM(weight, reps);
                // Simple logic: find which level range the 1RM falls into
                // We'll approximate by checking against the standard targets
                const multipliers = MACHINES_DATA[machine].multipliers[userProfile.gender];
                
                // Convert working set targets back to implied 1RM for comparison if needed
                // But simplified: 
                // Beginner: index 0
                // Novice: index 1
                // Intermediate: index 2
                // Advanced: index 3
                
                let achievedLevel = 'Beginner';
                EXPERIENCE_LEVELS.forEach((lvl, idx) => {
                    const mult = multipliers[idx];
                    const standard1RM = userProfile.weight * mult;
                    // Apply ratio logic to standard if machine uses it? 
                    // Actually getTargetWeight returns the stack weight.
                    // Let's use getTargetWeight logic to find the "Goal" for each level and compare user input
                    
                    // We need raw target 1RM from multipliers to compare apples to apples with calculated 1RM
                    // Or compare Working Weight to Working Weight. 
                    
                    // Let's calculate the working weight for this level (10 reps)
                    // Then compare user's estimated 10RM (via formula) to it.
                    const user10RM = est1RM * 0.75;
                    const standard1RM_for_level = userProfile.weight * mult * (MACHINES_DATA[machine].ratio ?? 1);
                    const standard10RM = standard1RM_for_level * 0.75;
                    
                    if (user10RM >= standard10RM) {
                        achievedLevel = lvl.label;
                    }
                });
                return achievedLevel;
            };

            const handleSaveLog = () => {
                if (!sessionLog.weight || !sessionLog.reps) return;
                
                const w = Number(sessionLog.weight);
                const r = Number(sessionLog.reps);
                
                // Check for level up
                const currentLevel = determineLevel(selectedMachine, w, r);
                const prevLift = userLifts[selectedMachine];
                const prevLevel = prevLift ? determineLevel(selectedMachine, prevLift.weight, prevLift.reps) : 'Unranked';
                
                const levels = ['Unranked', 'Beginner', 'Novice', 'Intermediate', 'Advanced'];
                if (levels.indexOf(currentLevel) > levels.indexOf(prevLevel)) {
                    setCelebration({ level: currentLevel, machine: selectedMachine });
                }

                setUserLifts(prev => ({
                    ...prev, [selectedMachine]: { weight: w, reps: r, date: new Date().toISOString() }
                }));
                setIsSaved(true);
                setTimeout(() => setIsSaved(false), 2000);
            };

            const getTargetWeight = (machineKey, level) => {
                const data = MACHINES_DATA[machineKey];
                const multipliers = data.multipliers[userProfile.gender];
                const idx = EXPERIENCE_LEVELS.findIndex(e => e.label === level);
                const multiplier1RM = multipliers[idx >= 0 ? idx : 0];

                let est1RM = userProfile.weight * multiplier1RM;
                let weight = viewMode === 'Working Set' ? est1RM * 0.75 : est1RM;

                const ratio = data.ratio ?? 1;
                weight = weight * ratio;

                if (data.stackCap) {
                    weight = Math.min(weight, data.stackCap);
                }

                return Math.max(10, Math.round(weight / 5) * 5);
            };

            const getWorkingSets = (targetWeight) => {
                const workingWeight = viewMode === '1 Rep Max' ? Math.round(targetWeight * 0.75 / 5) * 5 : targetWeight;
                const r5 = (n) => Math.max(10, Math.round(n / 5) * 5);

                return [
                    { type: "Warm-up", weight: r5(workingWeight * 0.5), reps: "15", note: "Light, focus on path" },
                    { type: "Set 1", weight: r5(workingWeight * 0.85), reps: "12", note: "Moderate effort" },
                    { type: "Set 2", weight: workingWeight, reps: "10", note: "Target working weight" },
                    { type: "Set 3", weight: r5(workingWeight * 1.05) > workingWeight ? r5(workingWeight * 1.05) : workingWeight, reps: "8-10", note: "Challenge Set" },
                ];
            };

            const getUserComparisonValue = (machineKey) => {
                const lift = userLifts[machineKey];
                if (!lift || !lift.weight || !lift.reps) return 0;

                const est1RM = calculateEstimated1RM(lift.weight, lift.reps);
                
                if (viewMode === '1 Rep Max') {
                    return est1RM;
                } else {
                    return Math.round(est1RM * 0.75);
                }
            };

            // --- VIEW RENDERERS ---

            const renderOnboarding = (isEditMode = false) => (
                <div className={`min-h-screen ${currentTheme.bgApp} flex items-center justify-center p-4 transition-colors duration-300`}>
                    <div className={`max-w-md w-full ${currentTheme.card} rounded-3xl shadow-xl overflow-hidden animate-in fade-in zoom-in duration-300`}>
                        <div className={`${currentTheme.primary} p-6 text-white relative`}>
                            {isEditMode && <button onClick={() => setView('settings')} className="absolute top-4 left-4 p-2 bg-white/20 rounded-full hover:bg-white/30 text-white"><Icons.ArrowLeft className="w-5 h-5"/></button>}
                            <h1 className="text-xl font-bold flex items-center gap-2 mb-1 justify-center">{isEditMode ? 'Edit Profile' : 'Setup Profile'}</h1>
                        </div>
                        <div className="p-5 space-y-5">
                            
                            <div className="flex items-center gap-3">
                                <div className="relative group cursor-pointer shrink-0">
                                    <div className="w-14 h-14 rounded-full bg-slate-100 flex items-center justify-center text-3xl border-2 border-slate-200">{userProfile.avatar}</div>
                                    <select className="absolute inset-0 opacity-0 cursor-pointer" value={userProfile.avatar} onChange={(e) => setUserProfile({...userProfile, avatar: e.target.value})}>{AVATARS.map(a => <option key={a} value={a}>{a}</option>)}</select>
                                </div>
                                <div className="flex-1">
                                    <label className={`block text-xs font-bold ${currentTheme.textLight} uppercase mb-1`}>Username</label>
                                    <input type="text" value={userProfile.username} onChange={(e) => setUserProfile({...userProfile, username: e.target.value})} className={`w-full p-3 rounded-xl border ${currentTheme.border} ${currentTheme.bgApp} font-bold ${currentTheme.textMain} focus:outline-none focus:ring-2 focus:ring-current`} />
                                </div>
                            </div>

                            {!isEditMode && (
                                <div>
                                    <label className={`block text-xs font-bold ${currentTheme.textLight} uppercase mb-2`}>Theme</label>
                                    <div className="flex gap-2">
                                        {Object.values(THEMES).map((t) => (
                                            <button key={t.id} onClick={() => setUserProfile(p => ({...p, themeId: t.id}))} className={`flex-1 h-10 rounded-lg border-2 ${userProfile.themeId === t.id ? `${t.primary} border-transparent text-white` : 'border-slate-200 bg-white text-slate-400'}`}>{t.name.split(' ')[0]}</button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className={`block text-xs font-bold ${currentTheme.textLight} uppercase mb-2`}>Gender</label>
                                    <div className="flex gap-2">
                                        {['Male', 'Female'].map((g) => (
                                            <button key={g} onClick={() => setUserProfile(p => ({...p, gender: g}))} className={`flex-1 py-3 rounded-xl font-bold text-xs border-2 ${userProfile.gender === g ? `${currentTheme.border} ${currentTheme.secondary} ${currentTheme.accentText}` : `${currentTheme.border} ${currentTheme.card} ${currentTheme.textLight}`}`}>{g}</button>
                                        ))}
                                    </div>
                                </div>
                                <StepperInput label="Age" value={userProfile.age} onChange={v => setUserProfile(p => ({...p, age: v}))} theme={currentTheme} />
                            </div>

                            <StepperInput label="Body Weight (lbs)" value={userProfile.weight} step={5} onChange={v => setUserProfile(p => ({...p, weight: v}))} theme={currentTheme} />

                            <div>
                                <label className={`block text-xs font-bold ${currentTheme.textLight} uppercase mb-2`}>Experience</label>
                                <div className="space-y-2">
                                    {EXPERIENCE_LEVELS.map((lvl) => (
                                        <button key={lvl.label} onClick={() => setUserProfile(p => ({...p, experience: lvl.label}))} className={`w-full p-3 rounded-xl border-2 text-left transition-all ${userProfile.experience === lvl.label ? `${currentTheme.border} ${currentTheme.secondary}` : `${currentTheme.border} ${currentTheme.card}`}`}>
                                            <div className="flex justify-between items-center">
                                                <span className={`font-bold text-sm ${userProfile.experience === lvl.label ? currentTheme.accentText : currentTheme.textMain}`}>{lvl.label}</span>
                                                {userProfile.experience === lvl.label && <Icons.CheckCircle className={`w-4 h-4 ${currentTheme.accentText}`} />}
                                            </div>
                                            <p className={`text-xs ${currentTheme.textLight} mt-1 font-medium`}>{lvl.desc}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <button onClick={() => setView(isEditMode ? 'settings' : 'welcome')} className={`w-full ${currentTheme.primary} ${currentTheme.primaryHover} text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95`}>
                                {isEditMode ? 'Save Changes' : 'Start Journey'} <Icons.ArrowRight className="w-5 h-5" />
                            </button>
                        </div>
                    </div>
                </div>
            );

            const renderWelcome = () => (
                <div className={`min-h-screen ${currentTheme.bgApp} flex flex-col items-center justify-center p-6 text-center animate-in fade-in duration-500`}>
                    <div className="mb-8 relative">
                        <div className={`absolute inset-0 ${currentTheme.secondary} blur-xl rounded-full opacity-50`}></div>
                        <div className="relative text-6xl animate-bounce">{userProfile.avatar}</div>
                    </div>
                    <h1 className={`text-3xl font-extrabold ${currentTheme.textMain} mb-3`}>Welcome, {userProfile.username}!</h1>
                    <p className={`text-sm ${currentTheme.textLight} max-w-xs mx-auto leading-relaxed mb-8`}>
                        Your strength journey starts now. Use this app to track your progress and crush your goals, one rep at a time.
                    </p>
                    <button onClick={() => setView('dashboard')} className={`px-8 py-4 rounded-full ${currentTheme.primary} text-white font-bold shadow-xl flex items-center gap-2 hover:scale-105 transition-transform`}>
                        Let's Get Strong <Icons.Dumbbell className="w-5 h-5"/>
                    </button>
                </div>
            );

            const renderSettingsMenu = () => (
                <div className={`min-h-screen ${currentTheme.bgApp} p-4`}>
                    <div className={`max-w-md mx-auto ${currentTheme.card} rounded-3xl shadow-sm border ${currentTheme.border} overflow-hidden`}>
                        <div className="p-6 border-b border-slate-100 flex items-center gap-3">
                            <button onClick={() => setView('dashboard')} className={`p-2 rounded-full ${currentTheme.bgApp} ${currentTheme.textMain}`}><Icons.ArrowLeft className="w-5 h-5"/></button>
                            <h1 className={`text-xl font-bold ${currentTheme.textMain}`}>Settings</h1>
                        </div>
                        <div className="p-4 space-y-2">
                            <button onClick={() => setView('edit_profile')} className={`w-full p-4 rounded-xl flex items-center justify-between ${currentTheme.bgApp} hover:bg-slate-100 transition-colors`}>
                                <div className="flex items-center gap-3">
                                    <div className={`p-2 rounded-lg ${currentTheme.secondary}`}><Icons.User className={`w-5 h-5 ${currentTheme.accentText}`} /></div>
                                    <div className="text-left">
                                        <span className={`block font-bold ${currentTheme.textMain}`}>Edit Profile</span>
                                        <span className="text-xs text-slate-400">Update weight, age, or goals</span>
                                    </div>
                                </div>
                                <Icons.ArrowRight className="w-4 h-4 text-slate-300" />
                            </button>

                            <button onClick={() => setView('theme')} className={`w-full p-4 rounded-xl flex items-center justify-between ${currentTheme.bgApp} hover:bg-slate-100 transition-colors`}>
                                <div className="flex items-center gap-3">
                                    <div className={`p-2 rounded-lg ${currentTheme.secondary}`}><Icons.Palette className={`w-5 h-5 ${currentTheme.accentText}`} /></div>
                                    <div className="text-left">
                                        <span className={`block font-bold ${currentTheme.textMain}`}>Theme</span>
                                        <span className="text-xs text-slate-400">Change app appearance</span>
                                    </div>
                                </div>
                                <Icons.ArrowRight className="w-4 h-4 text-slate-300" />
                            </button>

                            <button onClick={() => setView('about')} className={`w-full p-4 rounded-xl flex items-center justify-between ${currentTheme.bgApp} hover:bg-slate-100 transition-colors`}>
                                <div className="flex items-center gap-3">
                                    <div className={`p-2 rounded-lg ${currentTheme.secondary}`}><Icons.Info className={`w-5 h-5 ${currentTheme.accentText}`} /></div>
                                    <div className="text-left">
                                        <span className={`block font-bold ${currentTheme.textMain}`}>About</span>
                                        <span className="text-xs text-slate-400">Data sources & story</span>
                                    </div>
                                </div>
                                <Icons.ArrowRight className="w-4 h-4 text-slate-300" />
                            </button>
                        </div>
                    </div>
                </div>
            );

            const renderThemeSettings = () => (
                <div className={`min-h-screen ${currentTheme.bgApp} p-4 flex items-center justify-center`}>
                    <div className={`max-w-md w-full ${currentTheme.card} rounded-3xl shadow-lg border ${currentTheme.border} p-6`}>
                        <div className="flex items-center gap-3 mb-6">
                            <button onClick={() => setView('settings')} className={`p-2 rounded-full ${currentTheme.bgApp} ${currentTheme.textMain}`}><Icons.ArrowLeft className="w-5 h-5"/></button>
                            <h1 className={`text-xl font-bold ${currentTheme.textMain}`}>Choose Theme</h1>
                        </div>
                        <div className="space-y-3">
                            {Object.values(THEMES).map(t => (
                                <button key={t.id} onClick={() => setUserProfile({...userProfile, themeId: t.id})} className={`w-full p-4 rounded-xl border-2 flex items-center justify-between transition-all ${userProfile.themeId === t.id ? `${t.border} ${t.secondary}` : 'border-transparent bg-slate-50 hover:bg-slate-100'}`}>
                                    <div className="flex items-center gap-3">
                                        <div className={`w-8 h-8 rounded-full ${t.primary}`}></div>
                                        <span className={`font-bold ${t.textMain}`}>{t.name}</span>
                                    </div>
                                    {userProfile.themeId === t.id && <Icons.CheckCircle className={`w-5 h-5 ${t.accentText}`} />}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const renderAbout = () => (
                <div className={`min-h-screen ${currentTheme.bgApp} p-4 flex items-center justify-center`}>
                    <div className={`max-w-md w-full ${currentTheme.card} rounded-3xl shadow-lg border ${currentTheme.border} p-8`}>
                        <button onClick={() => setView('settings')} className={`mb-6 p-2 rounded-full ${currentTheme.bgApp} inline-block ${currentTheme.textMain}`}><Icons.ArrowLeft className="w-5 h-5"/></button>
                        <h1 className={`text-2xl font-bold ${currentTheme.textMain} mb-4`}>About This App</h1>
                        <div className={`space-y-4 text-sm ${currentTheme.textLight} leading-relaxed`}>
                            <p>
                                <strong className={currentTheme.textMain}>Why I built this:</strong> Physical transformation takes a long time. It's easy to get discouraged when the mirror doesn't change fast enough.
                            </p>
                            <p>
                                Strength, however, changes fast. Tracking your strength gains gives you immediate "wins" and proof that your hard work is paying off, even before your body shows it.
                            </p>
                            <hr className="border-slate-100" />
                            <p>
                                <strong className={currentTheme.textMain}>Data Sources:</strong>
                            </p>
                            <ul className="list-disc pl-4 space-y-1">
                                <li><strong>Strength Level (User Data):</strong> Aggregated from millions of logged lifts.</li>
                                <li><strong>ACSM Guidelines:</strong> For general fitness benchmarks.</li>
                                <li><strong>Machine Physics:</strong> Adjusted for pulley ratios (e.g., 2:1 cables) and stack limits specific to Planet Fitness equipment (Matrix/LifeFitness).</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );

            const renderDashboard = () => (
                <div className={`min-h-screen ${currentTheme.bgApp} font-sans pb-12 transition-colors duration-300`}>
                    <div className={`${currentTheme.card} border-b ${currentTheme.border} sticky top-0 z-20 shadow-sm backdrop-blur-md bg-opacity-90`}>
                        <div className="max-w-2xl mx-auto px-4 py-3 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className={`${currentTheme.primary} p-1.5 rounded-lg`}>
                                    <Icons.Activity className="h-5 w-5 text-white" />
                                </div>
                                <span className={`font-bold ${currentTheme.textMain} tracking-tight`}>PF Standards</span>
                            </div>
                            <button onClick={() => { setView('settings'); setSelectedMachine(null); }} className={`flex items-center gap-2 text-xs font-bold ${currentTheme.secondary} hover:opacity-80 ${currentTheme.accentText} px-3 py-1.5 rounded-full transition-colors border border-transparent`}>
                                <span className="text-base mr-1">{userProfile.avatar}</span>
                                <span>{userProfile.username}</span>
                                <Icons.Settings className="w-3.5 h-3.5" />
                            </button>
                        </div>
                    </div>

                    <div className="max-w-2xl mx-auto px-4 pt-4 relative z-10">
                        {/* Filters */}
                        {!selectedMachine && (
                            <div className="flex gap-2 overflow-x-auto no-scrollbar mb-4 pb-1">
                                {['All', 'Upper', 'Lower', 'Push', 'Pull', 'Core'].map(f => (
                                    <button 
                                        key={f} 
                                        onClick={() => setActiveFilter(f)}
                                        className={`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all ${activeFilter === f ? `${currentTheme.primary} text-white shadow-md` : `${currentTheme.card} ${currentTheme.textLight} border border-transparent`}`}
                                    >
                                        {f}
                                    </button>
                                ))}
                            </div>
                        )}

                        {!selectedMachine ? (
                            <div className="animate-in fade-in duration-500">
                                <div className="grid grid-cols-2 sm:grid-cols-3 gap-2">
                                    {Object.keys(MACHINES_DATA)
                                        .filter(name => activeFilter === 'All' || MACHINES_DATA[name].tags?.includes(activeFilter))
                                        .map(name => {
                                        const targetWeight = getTargetWeight(name, userProfile.experience);
                                        const isCapped = MACHINES_DATA[name].stackCap && targetWeight >= MACHINES_DATA[name].stackCap;
                                        const history = userLifts[name];
                                        
                                        return (
                                            <button key={name} onClick={() => setSelectedMachine(name)} className={`${currentTheme.card} p-3 rounded-xl shadow-sm border ${history ? currentTheme.border : 'border-transparent'} hover:border-current hover:${currentTheme.accentText} hover:shadow-md hover:-translate-y-0.5 transition-all text-left group flex flex-col justify-between h-full relative overflow-hidden`}>
                                                {history && (
                                                    <div className={`absolute top-0 right-0 px-2 py-1 rounded-bl-xl ${currentTheme.secondary} flex items-center gap-1`}>
                                                        <Icons.Clock className={`w-3 h-3 ${currentTheme.accentText}`} />
                                                    </div>
                                                )}
                                                <div>
                                                    <div className={`${currentTheme.secondary} ${currentTheme.accentText} w-9 h-9 rounded-full flex items-center justify-center mb-2 group-hover:${currentTheme.primary} group-hover:text-white transition-colors shadow-sm`}>
                                                        {name.includes("Leg") ? <Icons.Activity className="w-4 h-4"/> : <Icons.Dumbbell className="w-4 h-4"/>}
                                                    </div>
                                                    <span className={`font-bold ${currentTheme.textMain} text-xs leading-tight block mb-2`}>{name}</span>
                                                </div>
                                                {history ? (
                                                    <div className={`bg-slate-100 rounded-lg px-2 py-1 border border-slate-200`}>
                                                        <span className={`text-[8px] text-slate-400 uppercase tracking-wide font-bold block`}>Last</span>
                                                        <span className={`text-xs font-extrabold text-slate-600`}>{history.weight} lbs</span>
                                                    </div>
                                                ) : (
                                                    <div className={`${currentTheme.bgApp} rounded-lg px-2 py-1 border ${currentTheme.border} group-hover:${currentTheme.secondary} transition-colors`}>
                                                        <span className={`text-[8px] ${currentTheme.textLight} uppercase tracking-wide font-bold block`}>Goal ({viewMode === 'Working Set' ? 'Reps' : 'Max'})</span>
                                                        <div className="flex items-center gap-1">
                                                            <span className={`text-xs font-extrabold ${currentTheme.textMain} group-hover:${currentTheme.accentText}`}>{targetWeight} lbs</span>
                                                            {isCapped && <Icons.Lock className="w-3 h-3 text-slate-400" />}
                                                        </div>
                                                    </div>
                                                )}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-300">
                                <button onClick={() => setSelectedMachine(null)} className={`mb-4 text-sm font-bold ${currentTheme.textLight} hover:${currentTheme.accentText} flex items-center gap-1 pl-1`}>
                                    <Icons.ChevronDown className="w-4 h-4 rotate-90" /> Back to Machines
                                </button>

                                <div className={`${currentTheme.card} rounded-t-2xl p-6 border-b ${currentTheme.border} flex justify-between items-start`}>
                                    <div>
                                        <h2 className={`text-2xl font-extrabold ${currentTheme.textMain}`}>{selectedMachine}</h2>
                                        <p className={`${currentTheme.textLight} text-xs font-medium mt-1 uppercase tracking-wide`}>{MACHINES_DATA[selectedMachine].target}</p>
                                    </div>
                                    <button onClick={() => setSelectedMachine(null)} className={`${currentTheme.bgApp} p-2 rounded-full hover:opacity-80 transition-colors`}>
                                        <Icons.X className={`w-5 h-5 ${currentTheme.textLight}`} />
                                    </button>
                                </div>

                                <div className={`${currentTheme.card} rounded-b-2xl shadow-sm p-4 mb-4`}>
                                    <div className="flex mb-4 border-b border-slate-100">
                                        <button onClick={() => setActiveTab('workout')} className={`flex-1 pb-2 text-sm font-bold border-b-2 transition-colors ${activeTab === 'workout' ? `${currentTheme.accentText} border-current` : 'text-slate-400 border-transparent hover:text-slate-600'}`}>Workout & Log</button>
                                        <button onClick={() => setActiveTab('info')} className={`flex-1 pb-2 text-sm font-bold border-b-2 transition-colors ${activeTab === 'info' ? `${currentTheme.accentText} border-current` : 'text-slate-400 border-transparent hover:text-slate-600'}`}>Cues & Progress</button>
                                    </div>

                                    {activeTab === 'workout' ? (
                                        <>
                                            {/* History & Logger */}
                                            <div className="mb-6 space-y-4">
                                                {userLifts[selectedMachine] ? (
                                                    <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 flex items-center justify-between">
                                                        <div className="flex items-center gap-3">
                                                            <div className="bg-slate-200 p-2 rounded-full"><Icons.Clock className="w-4 h-4 text-slate-500" /></div>
                                                            <div>
                                                                <span className="text-[10px] uppercase font-bold text-slate-400 block">Last Session ({formatDate(userLifts[selectedMachine].date)})</span>
                                                                <span className="text-lg font-bold text-slate-700">{userLifts[selectedMachine].weight} lbs <span className="text-sm font-normal text-slate-400">x {userLifts[selectedMachine].reps}</span></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="bg-slate-50 border border-dashed border-slate-300 rounded-xl p-3 text-center">
                                                        <span className="text-xs text-slate-400 font-medium">No previous history logged.</span>
                                                    </div>
                                                )}

                                                <div className={`p-4 rounded-xl ${currentTheme.secondary} border ${currentTheme.border}`}>
                                                    <div className="flex items-center justify-between mb-3">
                                                        <div className="flex items-center gap-2">
                                                            <Icons.Trophy className={`w-4 h-4 ${currentTheme.accentText}`} />
                                                            <span className={`text-xs font-bold ${currentTheme.accentText} uppercase`}>Log Today's Set</span>
                                                        </div>
                                                        {isSaved && <span className="text-xs font-bold text-green-600 animate-pulse flex items-center gap-1"><Icons.CheckCircle className="w-3 h-3"/> Saved!</span>}
                                                    </div>
                                                    
                                                    <div className="flex gap-3 mb-3">
                                                        <div className="flex-1">
                                                            <label className={`text-[10px] font-bold ${currentTheme.textLight} uppercase block mb-1`}>Weight</label>
                                                            <input type="number" placeholder="0" value={sessionLog.weight} onChange={(e) => setSessionLog(prev => ({...prev, weight: e.target.value}))} className={`w-full p-2 rounded-lg font-bold text-lg ${currentTheme.card} ${currentTheme.textMain} focus:outline-none focus:ring-2 focus:ring-current`} />
                                                        </div>
                                                        <div className="flex-1">
                                                            <label className={`text-[10px] font-bold ${currentTheme.textLight} uppercase block mb-1`}>Reps</label>
                                                            <input type="number" placeholder="0" value={sessionLog.reps} onChange={(e) => setSessionLog(prev => ({...prev, reps: e.target.value}))} className={`w-full p-2 rounded-lg font-bold text-lg ${currentTheme.card} ${currentTheme.textMain} focus:outline-none focus:ring-2 focus:ring-current`} />
                                                        </div>
                                                    </div>
                                                    
                                                    <button onClick={handleSaveLog} className={`w-full py-2.5 rounded-lg font-bold text-sm text-white shadow-md flex items-center justify-center gap-2 transition-all active:scale-95 ${isSaved ? 'bg-green-500' : `${currentTheme.primary} ${currentTheme.primaryHover}`}`}>
                                                        {isSaved ? 'Workout Saved' : <><Icons.Save className="w-4 h-4" /> Save Result</>}
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Sets */}
                                            <div className="space-y-2">
                                                <h3 className={`text-xs font-bold ${currentTheme.textMain} mb-2 uppercase tracking-wider`}>Recommended Sets</h3>
                                                {getWorkingSets(getTargetWeight(selectedMachine, userProfile.experience)).map((set, idx) => (
                                                    <div key={idx} className={`flex items-center justify-between ${currentTheme.bgApp} p-3 rounded-xl border ${currentTheme.border}`}>
                                                        <div className="flex items-center gap-3">
                                                            <span className={`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold shadow-sm ${idx === 0 ? 'bg-blue-100 text-blue-600' : `${currentTheme.card} ${currentTheme.accentText}`}`}>{idx === 0 ? 'W' : idx}</span>
                                                            <div className="flex flex-col"><span className={`font-bold ${currentTheme.textMain} text-xs`}>{set.type}</span><span className={`text-[10px] ${currentTheme.textLight} font-medium`}>{set.note}</span></div>
                                                        </div>
                                                        <div className="text-right"><span className={`block font-mono font-bold ${currentTheme.textMain} text-sm`}>{set.weight}</span><span className={`text-[9px] ${currentTheme.textLight} uppercase font-bold`}>{set.reps} reps</span></div>
                                                    </div>
                                                ))}
                                                <div className={`flex items-center justify-between bg-orange-50 p-3 rounded-xl border border-orange-100 mt-2`}>
                                                    <div className="flex items-center gap-3">
                                                        <span className="w-6 h-6 rounded-full bg-white text-orange-500 border border-orange-100 flex items-center justify-center text-[10px] font-bold shadow-sm"><Icons.TrendingUp className="w-3 h-3" /></span>
                                                        <div className="flex flex-col"><span className="font-bold text-slate-800 text-xs">Finisher (Optional)</span><span className="text-[10px] text-slate-500 font-medium">{MACHINES_DATA[selectedMachine].burnout}</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <div className="space-y-4 animate-in fade-in slide-in-from-right-4 duration-300">
                                                {/* Cues */}
                                                <div className={`${currentTheme.bgApp} p-4 rounded-xl border ${currentTheme.border}`}>
                                                    <h3 className={`text-xs font-bold ${currentTheme.textMain} mb-3 flex items-center gap-2 uppercase tracking-wider`}>
                                                        <Icons.CheckCircle className="w-4 h-4 text-green-500" /> Form Cues
                                                    </h3>
                                                    <ul className="space-y-2">
                                                        {MACHINES_DATA[selectedMachine].cues.map((cue, i) => (
                                                            <li key={i} className={`text-sm ${currentTheme.textLight} flex items-start gap-2 leading-relaxed`}>
                                                                <span className="w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5 shrink-0"></span> {cue}
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>

                                                {/* Progression */}
                                                <div className={`${currentTheme.bgApp} p-4 rounded-xl border ${currentTheme.border}`}>
                                                    <h3 className={`text-xs font-bold ${currentTheme.textMain} mb-3 flex items-center gap-2 uppercase tracking-wider`}>
                                                        <Icons.AlertCircle className="w-4 h-4 text-blue-500" /> Progression
                                                    </h3>
                                                    <p className={`text-sm ${currentTheme.textLight} leading-relaxed font-medium`}>
                                                        {MACHINES_DATA[selectedMachine].adjustment}
                                                    </p>
                                                </div>

                                                {/* Ladder Visual */}
                                                <div className={`${currentTheme.bgApp} p-4 rounded-xl border ${currentTheme.border}`}>
                                                    <div className="flex items-center justify-between mb-6">
                                                        <h3 className={`text-xs font-bold ${currentTheme.textLight} uppercase tracking-wider`}>Strength Ladder</h3>
                                                        <span className={`text-[10px] font-bold ${currentTheme.textMain} bg-slate-200 px-2 py-1 rounded`}>Goal: {getTargetWeight(selectedMachine, userProfile.experience)} lbs</span>
                                                    </div>
                                                    
                                                    <div className="relative pb-2 px-2">
                                                        <div className={`h-1 bg-slate-200 rounded-full w-full absolute top-[11px] -translate-y-1/2 left-0 z-0`}></div>
                                                        
                                                        {getUserComparisonValue(selectedMachine) > 0 && (
                                                            <div 
                                                                className="absolute top-[-15px] z-20 flex flex-col items-center transition-all duration-500"
                                                                style={{ 
                                                                    left: `${Math.min(100, Math.max(0, (getUserComparisonValue(selectedMachine) / getTargetWeight(selectedMachine, 'Advanced')) * 85))}%`, 
                                                                }}
                                                            >
                                                                <div className={`${currentTheme.primary} text-white text-[9px] font-bold px-2 py-0.5 rounded-full shadow-md mb-1`}>YOU</div>
                                                                <div className="w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[6px] border-t-current text-purple-600" />
                                                            </div>
                                                        )}

                                                        <div className="flex justify-between relative z-10">
                                                            {EXPERIENCE_LEVELS.map((lvl) => {
                                                                const val = getTargetWeight(selectedMachine, lvl.label);
                                                                const isCurrent = lvl.label === userProfile.experience;
                                                                return (
                                                                    <div key={lvl.label} className="flex flex-col items-center w-1/4">
                                                                        <div className={`w-3 h-3 rounded-full mb-2 shadow-sm transition-all ${isCurrent ? `${currentTheme.primary} ring-2 ${currentTheme.secondary} scale-125` : `${currentTheme.card} border-2 ${currentTheme.border}`}`}></div>
                                                                        <span className={`text-[8px] uppercase font-bold mb-0.5 ${isCurrent ? currentTheme.accentText : currentTheme.textLight}`}>{lvl.label}</span>
                                                                        <span className={`text-[10px] font-mono font-bold ${isCurrent ? currentTheme.accentText : currentTheme.textLight}`}>{val}</span>
                                                                    </div>
                                                                )
                                                            })}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                    {celebration && <CelebrationModal data={celebration} onClose={() => setCelebration(null)} theme={currentTheme} />}
                </div>
            );

            // --- VIEW ROUTING ---
            if (view === 'onboarding') return renderOnboarding(false);
            if (view === 'edit_profile') return renderOnboarding(true);
            if (view === 'welcome') return renderWelcome();
            if (view === 'settings') return renderSettingsMenu();
            if (view === 'theme') return renderThemeSettings();
            if (view === 'about') return renderAbout();
            
            return renderDashboard();
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StrengthStandardsApp />);
    </script>
</body>
</html>
